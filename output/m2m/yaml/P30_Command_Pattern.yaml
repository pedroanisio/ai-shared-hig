id: P30
version: '1.1'
schema_version: '1.0'
metadata:
  name: Command Pattern
  category: pattern
  status: stable
  complexity: medium
  domains: []
definition:
  tuple_notation: $C = (commands, executor, undo\_stack, redo\_stack)$
  description: ''
  components:
  - name: commands
    type: Sequence⟨Command⟩
    notation: commands
    description: executed commands
  - name: executor
    type: Command → Effect
    notation: executor
    description: executes commands
  - name: undo\_stack
    type: Stack⟨Command⟩
    notation: undo\_stack
    description: for undo
  - name: redo\_stack
    type: Stack⟨Command⟩
    notation: redo\_stack
    description: for redo
type_definitions:
- name: Command
  definition: '(execute: () → Effect, undo: () → Effect, redo: () → Effect)'
  notation: 'Command := (execute: () → Effect, undo: () → Effect, redo: () → Effect)'
properties:
- id: P.P30.1
  name: Reversibility
  formal_spec: '∀cmd: undo(execute(cmd)) returns to pre-execution state'
  description: ''
  invariants: []
- id: P.P30.2
  name: Command History
  formal_spec: All executed commands pushed to undo_stack
  description: ''
  invariants: []
- id: P.P30.3
  name: Redo Invalidation
  formal_spec: New command execution → clear redo_stack
  description: ''
  invariants: []
operations:
- name: Execute
  signature: 'execute(cmd: Command) → Effect'
  formal_definition: "```\n   execute(cmd: Command) → Effect\n   = cmd.execute()\n     undo_stack := push(undo_stack,\
    \ cmd)\n     redo_stack := empty()  // Clear redo on new action"
  preconditions: []
  postconditions: []
  effects: []
- name: Undo
  signature: undo() → Effect
  formal_definition: "```\n   undo() → Effect\n   = if ¬empty(undo_stack):\n       cmd := pop(undo_stack)\n\
    \       cmd.undo()\n       redo_stack := push(redo_stack, cmd)"
  preconditions: []
  postconditions: []
  effects: []
- name: Redo
  signature: redo() → Effect
  formal_definition: "```\n   redo() → Effect\n   = if ¬empty(redo_stack):\n       cmd := pop(redo_stack)\n\
    \       cmd.redo()\n       undo_stack := push(undo_stack, cmd)"
  preconditions: []
  postconditions: []
  effects: []
manifestations:
- name: Undo/redo system
  description: ''
- name: Macro recording
  description: ''
- name: Transaction log
  description: ''
- name: Command history
  description: ''
