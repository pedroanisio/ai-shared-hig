id: P54
version: '1.1'
schema_version: '1.0'
metadata:
  name: Sorting Pattern
  category: pattern
  status: stable
  complexity: medium
  domains: []
definition:
  tuple_notation: $S = (data, columns, order, comparator)$
  description: ''
  components:
  - name: data
    type: Sequence⟨Item⟩
    notation: data
    description: dataset
  - name: columns
    type: Sequence⟨Column⟩
    notation: columns
    description: sortable columns
  - name: order
    type: Sequence⟨(Column, Direction)⟩
    notation: order
    description: sort specification
  - name: comparator
    type: Item × Item → \{-1, 0, 1\}
    notation: comparator
    description: comparison function
type_definitions:
- name: Column
  definition: '(name: String, type: Type, extract: Item → Value)'
  notation: 'Column := (name: String, type: Type, extract: Item → Value)'
- name: Direction
  definition: Asc | Desc
  notation: Direction := Asc | Desc
- name: Order
  definition: Sequence⟨(Column, Direction)⟩  // Multi-column sort
  notation: Order := Sequence⟨(Column, Direction)⟩  // Multi-column sort
properties:
- id: P.P54.1
  name: Stable Sort
  formal_spec: Items with equal sort keys maintain their original relative order
  description: ''
  invariants: []
- id: P.P54.2
  name: Multi-Column Sort
  formal_spec: Sort by order[0], then order[1] for ties, then order[2], ...
  description: ''
  invariants: []
- id: P.P54.3
  name: Type-Aware Comparison
  formal_spec: 'comparator respects type semantics:

    Numeric: 2 < 10

    String: "a" < "b" (lexicographic)

    Date: older < newer'
  description: ''
  invariants: []
operations:
- name: Sort Data
  signature: 'sort(data: Sequence⟨Item⟩, order: Order) → Sequence⟨Item⟩'
  formal_definition: "```\n   sort(data: Sequence⟨Item⟩, order: Order) → Sequence⟨Item⟩\n   = stable_sort(data,\
    \ composite_comparator(order))"
  preconditions: []
  postconditions: []
  effects: []
- name: Composite Comparator
  signature: 'composite_comparator(order: Order) → Comparator'
  formal_definition: "```\n   composite_comparator(order: Order) → Comparator\n   = λ(item1, item2):\n\
    \       for (column, direction) in order:\n         val1 := column.extract(item1)\n         val2 :=\
    \ column.extract(item2)\n         cmp := compare(val1, val2, column.type)\n         \n         if\
    \ cmp ≠ 0:\n           return cmp · (direction = Asc ? 1 : -1)\n       \n       return 0  // All keys\
    \ equal"
  preconditions: []
  postconditions: []
  effects: []
- name: Toggle Sort
  signature: 'toggle_sort(column: Column) → Effect'
  formal_definition: "```\n   toggle_sort(column: Column) → Effect\n   = if order[0].column = column:\n\
    \       order[0].direction := flip(order[0].direction)\n     else:\n       order := [(column, Asc)]\
    \ ++ order\n     \n     data := sort(data, order)"
  preconditions: []
  postconditions: []
  effects: []
- name: Clear Sort
  signature: clear_sort() → Effect
  formal_definition: "```\n   clear_sort() → Effect\n   = order := []\n     data := original_data"
  preconditions: []
  postconditions: []
  effects: []
- name: Single Column
  signature: Click column header → sort by that column
  formal_definition: "```\n   Click column header → sort by that column\n   Click again → reverse direction"
  preconditions: []
  postconditions: []
  effects: []
- name: Multi-Column (Shift-Click)
  signature: Click column → primary sort
  formal_definition: "```\n   Click column → primary sort\n   Shift+Click another → secondary sort\n \
    \  Shift+Click third → tertiary sort"
  preconditions: []
  postconditions: []
  effects: []
- name: Drag to Reorder
  signature: ''
  formal_definition: "```\n   Drag column headers to specify sort priority\n```\nName ▲     (sorted ascending)\n\
    Price ▼    (sorted descending)\nDate       (not sorted)\nName ▲(1) Price ▼(2)  (multi-column with\
    \ priority)"
  preconditions: []
  postconditions: []
  effects: []
manifestations:
- name: Data tables
  description: ''
- name: File explorers
  description: ''
- name: Email clients
  description: ''
- name: Spreadsheets
  description: ''
- name: Admin panels
  description: ''
