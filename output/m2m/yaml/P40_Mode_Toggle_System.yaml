id: P40
version: '1.1'
schema_version: '1.0'
metadata:
  name: Mode Toggle System
  category: pattern
  status: stable
  complexity: medium
  domains: []
definition:
  tuple_notation: $T = (M, m_0, \delta_{40}, \phi_{40}, \iota_{40})$
  description: ''
  components:
  - name: \delta_{40}
    type: M \times M → \{\text{allowed}, \text{forbidden}\}
    notation: \delta_{40}
    description: '**transition function**'
  - name: \phi_{40}
    type: M → UIConfig
    notation: \phi_{40}
    description: maps mode to **UI configuration**
  - name: \iota_{40}
    type: M → Indicator
    notation: \iota_{40}
    description: provides **visual indicators**
type_definitions: []
properties:
- id: P.P40.1
  name: Mutual Exclusivity
  formal_spec: '∀t: ∃!m ∈ M: active(m, t)'
  description: ''
  invariants: []
- id: P.P40.2
  name: Transition Atomicity
  formal_spec: transition(m_i, m_j) succeeds ⇔ δ₄₀(m_i, m_j) = allowed
  description: ''
  invariants: []
- id: P.P40.3
  name: UI Consistency
  formal_spec: active(m) ⇒ UI = φ₄₀(m)
  description: ''
  invariants: []
operations:
- name: Toggle Mode
  signature: 'toggle(m_target: Mode) → Effect'
  formal_definition: "```\n   toggle(m_target: Mode) → Effect\n   = if δ₄₀(m_current, m_target) = allowed:\n\
    \       save_state(m_current)\n       m_current := m_target\n       apply_ui(φ₄₀(m_target))\n    \
    \   restore_state(m_target)"
  preconditions: []
  postconditions: []
  effects: []
- name: Cycle Modes
  signature: cycle() → Effect
  formal_definition: "```\n   cycle() → Effect\n   = index := indexOf(M, m_current)\n     toggle(M[(index\
    \ + 1) mod |M|])"
  preconditions: []
  postconditions: []
  effects: []
manifestations:
- name: Auto-scroll toggle
  description: ''
- name: Edit vs Preview
  description: ''
- name: Tool modes
  description: ''
- name: View modes
  description: ''
