id: C4
version: '1.1'
schema_version: '1.0'
metadata:
  name: Metadata Schema
  category: concept
  status: stable
  complexity: medium
  domains: []
definition:
  tuple_notation: $M = (schema, data, validators)$
  description: ''
  components:
  - name: schema
    type: Map‚ü®String, Type‚ü©
    notation: schema
    description: defines field types
  - name: data
    type: Map‚ü®String, Value‚ü©
    notation: data
    description: actual metadata
  - name: validators
    type: Map‚ü®String, Predicate‚ü©
    notation: validators
    description: validation rules
type_definitions: []
properties:
- id: P.C4.1
  name: Type Safety
  formal_spec: '‚àÄk ‚àà keys(data): type(data[k]) = schema[k]'
  description: ''
  invariants: []
- id: P.C4.2
  name: Validation
  formal_spec: 'valid(M) ‚áî ‚àÄk ‚àà keys(data): validators[k](data[k])'
  description: ''
  invariants: []
- id: P.C4.3
  name: Extensibility
  formal_spec: extend(M, k, v) ‚Üí M' where keys(M'.data) = keys(M.data) ‚à™ {k}
  description: ''
  invariants: []
operations:
- name: Add Field
  signature: 'add(M: Metadata, k: String, v: Value) ‚Üí Metadata'
  formal_definition: "```\n   add(M: Metadata, k: String, v: Value) ‚Üí Metadata\n   = M' where M'.data[k]\
    \ = v\n            ‚àß validate(M'.schema[k], v)"
  preconditions: []
  postconditions: []
  effects: []
- name: Query
  signature: 'query(M: Metadata, pred: Predicate) ‚Üí ùîπ'
  formal_definition: "```\n   query(M: Metadata, pred: Predicate) ‚Üí \U0001D539\n   = pred(M.data)"
  preconditions: []
  postconditions: []
  effects: []
- name: Index
  signature: 'index(docs: Set‚ü®Document‚ü©, field: String) ‚Üí Map‚ü®Value, Set‚ü®Document‚ü©‚ü©'
  formal_definition: "```\n   index(docs: Set‚ü®Document‚ü©, field: String) ‚Üí Map‚ü®Value, Set‚ü®Document‚ü©‚ü©\n\
    \   = group documents by field value"
  preconditions: []
  postconditions: []
  effects: []
manifestations:
- name: Tags
  description: blog posts, notes
- name: Properties
  description: CAD features
- name: Attributes
  description: HTML elements
- name: Annotations
  description: PDF, code comments
- name: Labels
  description: issue tracking
