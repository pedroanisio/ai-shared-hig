id: P22
version: '1.1'
schema_version: '1.0'
metadata:
  name: Event Bus
  category: pattern
  status: stable
  complexity: medium
  domains: []
definition:
  tuple_notation: $B = (publishers, subscribers, topics, broker)$
  description: ''
  components:
  - name: publishers
    type: Set⟨Publisher⟩
    notation: publishers
    description: emit events
  - name: subscribers
    type: Map⟨Topic, Set⟨Subscriber⟩⟩
    notation: subscribers
    description: listen for events
  - name: topics
    type: Set⟨Topic⟩
    notation: topics
    description: event channels
  - name: broker
    type: (Topic, Event) → Effect
    notation: broker
    description: routes events
type_definitions:
- name: Publisher
  definition: '(id: ID, publish: (Topic, Event) → Effect)'
  notation: 'Publisher := (id: ID, publish: (Topic, Event) → Effect)'
- name: Subscriber
  definition: '(id: ID, handle: Event → Effect)'
  notation: 'Subscriber := (id: ID, handle: Event → Effect)'
- name: Topic
  definition: String
  notation: Topic := String
- name: Event
  definition: '(type: String, payload: Map⟨String, Value⟩, timestamp: Time)'
  notation: 'Event := (type: String, payload: Map⟨String, Value⟩, timestamp: Time)'
properties:
- id: P.P22.1
  name: Decoupling
  formal_spec: 'Publishers don''t know subscribers

    Subscribers don''t know publishers'
  description: ''
  invariants: []
- id: P.P22.2
  name: Many-to-Many
  formal_spec: 'One event → multiple subscribers

    One subscriber → multiple topics'
  description: ''
  invariants: []
- id: P.P22.3
  name: Async Delivery
  formal_spec: 'publish(event) returns immediately

    Delivery happens asynchronously'
  description: ''
  invariants: []
operations:
- name: Subscribe
  signature: 'subscribe(topic: Topic, subscriber: Subscriber) → Effect'
  formal_definition: "```\n   subscribe(topic: Topic, subscriber: Subscriber) → Effect\n   = subscribers[topic]\
    \ := subscribers[topic] ∪ {subscriber}"
  preconditions: []
  postconditions: []
  effects: []
- name: Publish
  signature: 'publish(topic: Topic, event: Event) → Effect'
  formal_definition: "```\n   publish(topic: Topic, event: Event) → Effect\n   = for subscriber in subscribers[topic]:\n\
    \       async_invoke(subscriber.handle, event)"
  preconditions: []
  postconditions: []
  effects: []
- name: Unsubscribe
  signature: 'unsubscribe(topic: Topic, subscriber: Subscriber) → Effect'
  formal_definition: "```\n   unsubscribe(topic: Topic, subscriber: Subscriber) → Effect\n   = subscribers[topic]\
    \ := subscribers[topic] ∖ {subscriber}"
  preconditions: []
  postconditions: []
  effects: []
- name: At-Most-Once
  signature: ''
  formal_definition: "```\n   Fire and forget\n   Fast but may lose events"
  preconditions: []
  postconditions: []
  effects: []
- name: At-Least-Once
  signature: ''
  formal_definition: "```\n   Retry until acknowledged\n   May duplicate events"
  preconditions: []
  postconditions: []
  effects: []
- name: Exactly-Once
  signature: ''
  formal_definition: "```\n   Deduplication + acknowledgment\n   Expensive but reliable"
  preconditions: []
  postconditions: []
  effects: []
manifestations:
- name: UI event system
  description: ''
- name: Component communication
  description: ''
- name: Plugin events
  description: ''
- name: Message queues
  description: ''
