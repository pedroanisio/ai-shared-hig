id: P8
version: '1.1'
schema_version: '1.0'
metadata:
  name: Search-Based Navigation
  category: pattern
  status: stable
  complexity: medium
  domains: []
definition:
  tuple_notation: $S = (query, index, results, ranker)$
  description: ''
  components:
  - name: query
    type: String
    notation: query
    description: search query
  - name: index
    type: Index⟨Item⟩
    notation: index
    description: searchable index
  - name: results
    type: Sequence⟨Item⟩
    notation: results
    description: ranked results
  - name: ranker
    type: (Item, String) → ℝ
    notation: ranker
    description: scores relevance
type_definitions: []
properties:
- id: P.P8.1
  name: Real-Time Results
  formal_spec: type(query[0..n]) → results updated within 100ms
  description: ''
  invariants: []
- id: P.P8.2
  name: Fuzzy Matching
  formal_spec: query = "fle" matches "file", "filter", "flexible"
  description: ''
  invariants: []
- id: P.P8.3
  name: Ranking
  formal_spec: results sorted by ranker(item, query) descending
  description: ''
  invariants: []
operations:
- name: Search
  signature: 'search(q: String) → Sequence⟨Item⟩'
  formal_definition: "```\n   search(q: String) → Sequence⟨Item⟩\n   = candidates := fuzzy_match(index,\
    \ q)\n     scores := map(candidates, λitem: ranker(item, q))\n     sort(zip(candidates, scores), by:\
    \ score, desc)\n     → take(20)"
  preconditions: []
  postconditions: []
  effects: []
- name: Update Index
  signature: 'index(items: Set⟨Item⟩) → Effect'
  formal_definition: "```\n   index(items: Set⟨Item⟩) → Effect\n   = for item in items:\n       tokens\
    \ := tokenize(item)\n       for token in tokens:\n         inverted_index[token] := inverted_index[token]\
    \ ∪ {item}"
  preconditions: []
  postconditions: []
  effects: []
- name: Rank
  signature: 'ranker(item: Item, query: String) → ℝ'
  formal_definition: "```\n   ranker(item: Item, query: String) → ℝ\n   = w₁·string_similarity(item.name,\
    \ query)\n     + w₂·recency_score(item.timestamp)\n     + w₃·frequency_score(item.access_count)"
  preconditions: []
  postconditions: []
  effects: []
manifestations:
- name: File search
  description: Spotlight, Everything
- name: Theorem search
  description: Lean libraries
- name: Command palette
  description: editors
- name: Symbol search
  description: code navigation
