id: P29
version: '1.1'
schema_version: '1.0'
metadata:
  name: Centralized State Store
  category: pattern
  status: stable
  complexity: medium
  domains: []
definition:
  tuple_notation: $S = (store, reducers, selectors, subscriptions)$
  description: ''
  components:
  - name: store
    type: State
    notation: store
    description: application state (single source of truth)
  - name: reducers
    type: Map⟨Action, Reducer⟩
    notation: reducers
    description: update state
  - name: selectors
    type: Map⟨String, Selector⟩
    notation: selectors
    description: query state
  - name: subscriptions
    type: Set⟨Subscriber⟩
    notation: subscriptions
    description: listen for changes
type_definitions:
- name: State
  definition: Map⟨String, Value⟩
  notation: State := Map⟨String, Value⟩
- name: Action
  definition: '(type: String, payload: Value)'
  notation: 'Action := (type: String, payload: Value)'
- name: Reducer
  definition: (State, Action) → State
  notation: Reducer := (State, Action) → State
- name: Selector
  definition: State → Value
  notation: Selector := State → Value
- name: Subscriber
  definition: State → Effect
  notation: Subscriber := State → Effect
properties:
- id: P.P29.1
  name: Single Source of Truth
  formal_spec: '∃! store: all application state in store'
  description: ''
  invariants: []
- id: P.P29.2
  name: Immutable Updates
  formal_spec: reducer(state, action) returns new state, doesn't mutate old state
  description: ''
  invariants: []
- id: P.P29.3
  name: Unidirectional Flow
  formal_spec: action → reducer → new_state → notify_subscribers
  description: ''
  invariants: []
operations:
- name: Dispatch Action
  signature: 'dispatch(action: Action) → Effect'
  formal_definition: "```\n   dispatch(action: Action) → Effect\n   = reducer := reducers[action.type]\n\
    \     new_state := reducer(store, action)\n     store := new_state\n     notify_all_subscribers(store)"
  preconditions: []
  postconditions: []
  effects: []
- name: Subscribe
  signature: 'subscribe(subscriber: Subscriber) → UnsubscribeFunc'
  formal_definition: "```\n   subscribe(subscriber: Subscriber) → UnsubscribeFunc\n   = subscriptions\
    \ := subscriptions ∪ {subscriber}\n     return λ: subscriptions := subscriptions ∖ {subscriber}"
  preconditions: []
  postconditions: []
  effects: []
- name: Select
  signature: 'select(selector_name: String) → Value'
  formal_definition: "```\n   select(selector_name: String) → Value\n   = selector := selectors[selector_name]\n\
    \     return selector(store)"
  preconditions: []
  postconditions: []
  effects: []
manifestations:
- name: Redux
  description: JavaScript
- name: Vuex
  description: Vue.js
- name: Global state
  description: any framework
- name: Application model
  description: ''
