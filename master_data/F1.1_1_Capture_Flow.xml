<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="" version="1.1">
  <metadata>
    <name/>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$F = (source, validator, normalizer, store)$</tuple-notation>
    <components>
      <component>
        <name>source</name>
        <type>Input</type>
        <notation>source</notation>
        <description>external input source</description>
      </component>
      <component>
        <name>validator</name>
        <type>Input → Valid | Invalid</type>
        <notation>validator</notation>
        <description>checks input validity</description>
      </component>
      <component>
        <name>normalizer</name>
        <type>Valid → Internal</type>
        <notation>normalizer</notation>
        <description>converts to internal format</description>
      </component>
      <component>
        <name>store</name>
        <type>Internal → Effect</type>
        <notation>store</notation>
        <description>persists in system</description>
      </component>
    </components>
  </definition>
  <type-definitions>
    <type-def>
      <name>Input</name>
      <definition format="latex">External data or event</definition>
    </type-def>
    <type-def>
      <name>Valid</name>
      <definition format="latex">Validated input that passed checks</definition>
    </type-def>
    <type-def>
      <name>Internal</name>
      <definition format="latex">Normalized internal representation</definition>
    </type-def>
    <type-def>
      <name>Effect</name>
      <definition format="latex">Side effect of storage operation</definition>
    </type-def>
  </type-definitions>
  <properties>
    <property id="P.F1.1.1">
      <name>Validation Required</name>
      <formal-spec format="latex">∀i ∈ Input: store(i) ⇒ validator(i) = Valid
No invalid input reaches storage</formal-spec>
    </property>
    <property id="P.F1.1.2">
      <name>Normalization</name>
      <formal-spec format="latex">∀v ∈ Valid: normalizer(v) produces consistent Internal format</formal-spec>
    </property>
    <property id="P.F1.1.3">
      <name>Persistence</name>
      <formal-spec format="latex">∀i ∈ Internal: store(i) ⇒ retrievable(i)</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Capture</name>
      <signature>capture(input: Input) → Effect</signature>
      <formal-definition format="latex">```
   capture(input: Input) → Effect
   = case validator(input) of
       Valid(v) → store(normalizer(v))
       Invalid(e) → log_error(e) ; reject(input)</formal-definition>
    </operation>
    <operation>
      <name>Validate</name>
      <signature>validate(input: Input) → Valid | Invalid</signature>
      <formal-definition format="latex">```
   validate(input: Input) → Valid | Invalid
   = check_schema(input) ∧ 
     check_constraints(input) ∧
     check_permissions(input)</formal-definition>
    </operation>
    <operation>
      <name>Normalize</name>
      <signature>normalize(valid: Valid) → Internal</signature>
      <formal-definition format="latex">```
   normalize(valid: Valid) → Internal
   = transform_to_canonical_format(valid)</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>User input forms</name>
    </manifestation>
    <manifestation>
      <name>File upload handlers</name>
    </manifestation>
    <manifestation>
      <name>API request handlers</name>
    </manifestation>
    <manifestation>
      <name>Sensor data ingestion</name>
    </manifestation>
    <manifestation>
      <name>Clipboard paste operations</name>
    </manifestation>
  </manifestations>
</pattern>
