<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P4" version="1.1">
  <metadata>
    <name>Property Inspector</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$I = (selection, fields, validators, commit)$</tuple-notation>
    <components>
      <component>
        <name>selection</name>
        <type>Element | null</type>
        <notation>selection</notation>
        <description>inspected object</description>
      </component>
      <component>
        <name>fields</name>
        <type>Map⟨String, Field⟩</type>
        <notation>fields</notation>
        <description>editable properties</description>
      </component>
      <component>
        <name>validators</name>
        <type>Map⟨String, Validator⟩</type>
        <notation>validators</notation>
        <description>validate changes</description>
      </component>
      <component>
        <name>commit</name>
        <type>(String, Value) → Effect</type>
        <notation>commit</notation>
        <description>applies changes</description>
      </component>
    </components>
  </definition>
  <properties>
    <property id="P.P4.1">
      <name>Selection-Driven</name>
      <formal-spec format="latex">selection changes → reload_fields(selection)</formal-spec>
    </property>
    <property id="P.P4.2">
      <name>Validation Before Commit</name>
      <formal-spec format="latex">commit(field, value) succeeds ⇔ validators[field](value) = valid</formal-spec>
    </property>
    <property id="P.P4.3">
      <name>Immediate or Delayed Commit</name>
      <formal-spec format="latex">Mode 1 (immediate): onChange → commit
Mode 2 (delayed): onChange → stage, onBlur → commit</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Load Properties</name>
      <signature>load(element: Element) → Map⟨String, Value⟩</signature>
      <formal-definition format="latex">```
   load(element: Element) → Map⟨String, Value⟩
   = {(k, v) : k ∈ properties(element), v = element[k]}</formal-definition>
    </operation>
    <operation>
      <name>Validate Field</name>
      <signature>validate(field: String, value: Value) → ValidationResult</signature>
      <formal-definition format="latex">```
   validate(field: String, value: Value) → ValidationResult
   = validators[field](value)</formal-definition>
    </operation>
    <operation>
      <name>Commit Change</name>
      <signature>commit(field: String, value: Value) → Effect</signature>
      <formal-definition format="latex">```
   commit(field: String, value: Value) → Effect
   = if validate(field, value) = valid:
       selection[field] := value
       update_dependents(field)
       notify_observers(selection)</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>Properties panel</name>
      <description>design tools</description>
    </manifestation>
    <manifestation>
      <name>Inspector</name>
      <description>browser DevTools</description>
    </manifestation>
    <manifestation>
      <name>Settings panel</name>
      <description>applications</description>
    </manifestation>
    <manifestation>
      <name>Attributes editor</name>
      <description>HTML editors</description>
    </manifestation>
  </manifestations>
</pattern>
