<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P53" version="1.1">
  <metadata>
    <name>Filtering Pattern</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$F = (data, filters, active, result, facets)$</tuple-notation>
    <components>
      <component>
        <name>data</name>
        <type>Set⟨Item⟩</type>
        <notation>data</notation>
        <description>full dataset</description>
      </component>
      <component>
        <name>filters</name>
        <type>Map⟨String, Filter⟩</type>
        <notation>filters</notation>
        <description>available filters</description>
      </component>
      <component>
        <name>active</name>
        <type>Map⟨String, FilterValue⟩</type>
        <notation>active</notation>
        <description>active filters</description>
      </component>
      <component>
        <name>result</name>
        <type>Set⟨Item⟩</type>
        <notation>result</notation>
        <description>filtered result</description>
      </component>
      <component>
        <name>facets</name>
        <type>Map⟨String, Facet⟩</type>
        <notation>facets</notation>
        <description>shows filter counts</description>
      </component>
    </components>
  </definition>
  <type-definitions>
    <type-def>
      <name>Filter</name>
      <definition format="latex">(</definition>
    </type-def>
    <type-def>
      <name>FilterType</name>
      <definition format="latex">Range | Select | MultiSelect | Search | Boolean</definition>
    </type-def>
    <type-def>
      <name>FilterValue</name>
      <definition format="latex">Value | Range(min, max) | Set⟨Value⟩</definition>
    </type-def>
    <type-def>
      <name>Facet</name>
      <definition format="latex">Map⟨Value, ℕ⟩  // value → count</definition>
    </type-def>
  </type-definitions>
  <properties>
    <property id="P.P53.1">
      <name>Result Computation</name>
      <formal-spec format="latex">result = {item ∈ data : ∀(k, v) ∈ active: filters[k].apply(item, v)}</formal-spec>
    </property>
    <property id="P.P53.2">
      <name>Facet Accuracy</name>
      <formal-spec format="latex">facets[filter_k][value_v] = |{item ∈ result : item[k] = value_v}|</formal-spec>
    </property>
    <property id="P.P53.3">
      <name>Filter Composition</name>
      <formal-spec format="latex">Multiple filters combined with AND (intersection)
Multi-select within filter combined with OR (union)</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Apply Filter</name>
      <signature>apply_filter(filter_name: String, value: FilterValue) → Effect</signature>
      <formal-definition format="latex">```
   apply_filter(filter_name: String, value: FilterValue) → Effect
   = active[filter_name] := value
     result := compute_result(data, active)
     facets := compute_facets(result, filters)
     notify_observers(result)</formal-definition>
    </operation>
    <operation>
      <name>Compute Result</name>
      <signature>compute_result(data: Set⟨Item⟩, active: Map⟨String, FilterValue⟩) → Set⟨Item⟩</signature>
      <formal-definition format="latex">```
   compute_result(data: Set⟨Item⟩, active: Map⟨String, FilterValue⟩) → Set⟨Item⟩
   = filter(data, λitem:
       ∀(k, v) ∈ active: filters[k].apply(item, v)
     )</formal-definition>
    </operation>
    <operation>
      <name>Compute Facets</name>
      <signature>compute_facets(result: Set⟨Item⟩, filters: Map⟨String, Filter⟩) → Map⟨String, Facet⟩</signature>
      <formal-definition format="latex">```
   compute_facets(result: Set⟨Item⟩, filters: Map⟨String, Filter⟩) → Map⟨String, Facet⟩
   = {
       (filter_name, {
         (value, count(result, λitem: item[filter_name] = value))
         for value in possible_values(filter_name)
       })
       for filter_name in keys(filters)
     }</formal-definition>
    </operation>
    <operation>
      <name>Clear Filters</name>
      <signature>clear() → Effect</signature>
      <formal-definition format="latex">```
   clear() → Effect
   = active := {}
     result := data
     facets := compute_facets(result, filters)</formal-definition>
    </operation>
    <operation>
      <name>Range Filter</name>
      <signature/>
      <formal-definition format="latex">```
   Price: $0 - $1000
   apply(item, (min, max)) = min ≤ item.price ≤ max
6. **Multi-Select Filter:
```
   Colors: [✓ Red] [✓ Blue] [ ] Green
   apply(item, selected) = item.color ∈ selected
7. Search Filter:**
```
   Search: "laptop"
   apply(item, query) = contains(item.name, query, case_insensitive)</formal-definition>
    </operation>
    <operation>
      <name>Boolean Filter</name>
      <signature/>
      <formal-definition format="latex">```
   [✓] In Stock Only
   apply(item, true) = item.in_stock</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>E-commerce product filters</name>
    </manifestation>
    <manifestation>
      <name>Search result filters</name>
    </manifestation>
    <manifestation>
      <name>Data table column filters</name>
    </manifestation>
    <manifestation>
      <name>Email filters</name>
    </manifestation>
    <manifestation>
      <name>Log viewers</name>
    </manifestation>
  </manifestations>
</pattern>
