<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P54" version="1.1">
  <metadata>
    <name>Sorting Pattern</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$S = (data, columns, order, comparator)$</tuple-notation>
    <components>
      <component>
        <name>data</name>
        <type>Sequence⟨Item⟩</type>
        <notation>data</notation>
        <description>dataset</description>
      </component>
      <component>
        <name>columns</name>
        <type>Sequence⟨Column⟩</type>
        <notation>columns</notation>
        <description>sortable columns</description>
      </component>
      <component>
        <name>order</name>
        <type>Sequence⟨(Column, Direction)⟩</type>
        <notation>order</notation>
        <description>sort specification</description>
      </component>
      <component>
        <name>comparator</name>
        <type>Item × Item → \{-1, 0, 1\}</type>
        <notation>comparator</notation>
        <description>comparison function</description>
      </component>
    </components>
  </definition>
  <type-definitions>
    <type-def>
      <name>Column</name>
      <definition format="latex">(name: String, type: Type, extract: Item → Value)</definition>
    </type-def>
    <type-def>
      <name>Direction</name>
      <definition format="latex">Asc | Desc</definition>
    </type-def>
    <type-def>
      <name>Order</name>
      <definition format="latex">Sequence⟨(Column, Direction)⟩  // Multi-column sort</definition>
    </type-def>
  </type-definitions>
  <properties>
    <property id="P.P54.1">
      <name>Stable Sort</name>
      <formal-spec format="latex">Items with equal sort keys maintain their original relative order</formal-spec>
    </property>
    <property id="P.P54.2">
      <name>Multi-Column Sort</name>
      <formal-spec format="latex">Sort by order[0], then order[1] for ties, then order[2], ...</formal-spec>
    </property>
    <property id="P.P54.3">
      <name>Type-Aware Comparison</name>
      <formal-spec format="latex">comparator respects type semantics:
Numeric: 2 &lt; 10
String: "a" &lt; "b" (lexicographic)
Date: older &lt; newer</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Sort Data</name>
      <signature>sort(data: Sequence⟨Item⟩, order: Order) → Sequence⟨Item⟩</signature>
      <formal-definition format="latex">```
   sort(data: Sequence⟨Item⟩, order: Order) → Sequence⟨Item⟩
   = stable_sort(data, composite_comparator(order))</formal-definition>
    </operation>
    <operation>
      <name>Composite Comparator</name>
      <signature>composite_comparator(order: Order) → Comparator</signature>
      <formal-definition format="latex">```
   composite_comparator(order: Order) → Comparator
   = λ(item1, item2):
       for (column, direction) in order:
         val1 := column.extract(item1)
         val2 := column.extract(item2)
         cmp := compare(val1, val2, column.type)
         
         if cmp ≠ 0:
           return cmp · (direction = Asc ? 1 : -1)
       
       return 0  // All keys equal</formal-definition>
    </operation>
    <operation>
      <name>Toggle Sort</name>
      <signature>toggle_sort(column: Column) → Effect</signature>
      <formal-definition format="latex">```
   toggle_sort(column: Column) → Effect
   = if order[0].column = column:
       order[0].direction := flip(order[0].direction)
     else:
       order := [(column, Asc)] ++ order
     
     data := sort(data, order)</formal-definition>
    </operation>
    <operation>
      <name>Clear Sort</name>
      <signature>clear_sort() → Effect</signature>
      <formal-definition format="latex">```
   clear_sort() → Effect
   = order := []
     data := original_data</formal-definition>
    </operation>
    <operation>
      <name>Single Column</name>
      <signature>Click column header → sort by that column</signature>
      <formal-definition format="latex">```
   Click column header → sort by that column
   Click again → reverse direction</formal-definition>
    </operation>
    <operation>
      <name>Multi-Column (Shift-Click)</name>
      <signature>Click column → primary sort</signature>
      <formal-definition format="latex">```
   Click column → primary sort
   Shift+Click another → secondary sort
   Shift+Click third → tertiary sort</formal-definition>
    </operation>
    <operation>
      <name>Drag to Reorder</name>
      <signature/>
      <formal-definition format="latex">```
   Drag column headers to specify sort priority
```
Name ▲     (sorted ascending)
Price ▼    (sorted descending)
Date       (not sorted)
Name ▲(1) Price ▼(2)  (multi-column with priority)</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>Data tables</name>
    </manifestation>
    <manifestation>
      <name>File explorers</name>
    </manifestation>
    <manifestation>
      <name>Email clients</name>
    </manifestation>
    <manifestation>
      <name>Spreadsheets</name>
    </manifestation>
    <manifestation>
      <name>Admin panels</name>
    </manifestation>
  </manifestations>
</pattern>
