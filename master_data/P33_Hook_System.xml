<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P33" version="1.1">
  <metadata>
    <name>Hook System</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$H = (hooks, handlers, register, invoke)$</tuple-notation>
    <components>
      <component>
        <name>hooks</name>
        <type>Set⟨HookPoint⟩</type>
        <notation>hooks</notation>
        <description>extension points</description>
      </component>
      <component>
        <name>handlers</name>
        <type>Map⟨HookPoint, Sequence⟨Handler⟩⟩</type>
        <notation>handlers</notation>
        <description>registered handlers</description>
      </component>
      <component>
        <name>register</name>
        <type>(HookPoint, Handler) → Effect</type>
        <notation>register</notation>
        <description>registers handlers</description>
      </component>
      <component>
        <name>invoke</name>
        <type>(HookPoint, Context) → Effect</type>
        <notation>invoke</notation>
        <description>invokes handlers</description>
      </component>
    </components>
  </definition>
  <type-definitions>
    <type-def>
      <name>HookPoint</name>
      <definition format="latex">String  // e.g., "before:save", "after:render"</definition>
    </type-def>
    <type-def>
      <name>Handler</name>
      <definition format="latex">Context → Effect</definition>
    </type-def>
    <type-def>
      <name>Context</name>
      <definition format="latex">Map⟨String, Value⟩  // Hook-specific data</definition>
    </type-def>
  </type-definitions>
  <properties>
    <property id="P.P33.1">
      <name>Handler Order</name>
      <formal-spec format="latex">Handlers invoked in registration order</formal-spec>
    </property>
    <property id="P.P33.2">
      <name>Error Handling</name>
      <formal-spec format="latex">Handler error doesn't prevent other handlers from running</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Register Handler</name>
      <signature>register(hook: HookPoint, handler: Handler, priority: ℕ) → Effect</signature>
      <formal-definition format="latex">```
   register(hook: HookPoint, handler: Handler, priority: ℕ) → Effect
   = handlers[hook] := insert_sorted(handlers[hook], (handler, priority))</formal-definition>
    </operation>
    <operation>
      <name>Invoke Hooks</name>
      <signature>invoke(hook: HookPoint, context: Context) → Effect</signature>
      <formal-definition format="latex">```
   invoke(hook: HookPoint, context: Context) → Effect
   = for (handler, priority) in handlers[hook]:
       try:
         handler(context)
       catch error:
         log_error(error)
         // Continue with next handler
```
Application lifecycle:
  - app:init
  - app:ready
  - app:shutdown

Data operations:
  - before:save
  - after:save
  - before:delete
  - after:delete

Rendering:
  - before:render
  - after:render</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>Lifecycle hooks</name>
      <description>React, Vue</description>
    </manifestation>
    <manifestation>
      <name>Event handlers</name>
    </manifestation>
    <manifestation>
      <name>Middleware</name>
    </manifestation>
    <manifestation>
      <name>Aspect-oriented programming</name>
    </manifestation>
  </manifestations>
</pattern>
