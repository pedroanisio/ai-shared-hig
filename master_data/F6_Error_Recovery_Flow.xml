<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="F6" version="1.1">
  <metadata>
    <name>Error Recovery Flow</name>
    <category>flow</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$E = (detect, classify, strategy, recover)$</tuple-notation>
    <components>
      <component>
        <name>detect</name>
        <type>Operation → Error | Success</type>
        <notation>detect</notation>
        <description>catches errors</description>
      </component>
      <component>
        <name>classify</name>
        <type>Error → ErrorType</type>
        <notation>classify</notation>
        <description>determines error category</description>
      </component>
      <component>
        <name>strategy</name>
        <type>ErrorType → RecoveryStrategy</type>
        <notation>strategy</notation>
        <description>selects recovery approach</description>
      </component>
      <component>
        <name>recover</name>
        <type>(Error, RecoveryStrategy) → Effect</type>
        <notation>recover</notation>
        <description>executes recovery</description>
      </component>
    </components>
  </definition>
  <type-definitions>
    <type-def>
      <name>ErrorType</name>
      <definition format="latex">Transient | Permanent | Recoverable</definition>
    </type-def>
    <type-def>
      <name>RecoveryStrategy</name>
      <definition format="latex">Retry(max: ℕ, backoff: Time → Time) |</definition>
    </type-def>
    <type-def>
      <name>Operation</name>
      <definition format="latex">() → Result | Error</definition>
    </type-def>
  </type-definitions>
  <properties>
    <property id="P.F6.1">
      <name>Error Classification</name>
      <formal-spec format="latex">∀e ∈ Error: classify(e) determines appropriate recovery strategy
Transient → Retry
Permanent → Report
Recoverable → Fallback | GracefulDegradation</formal-spec>
    </property>
    <property id="P.F6.2">
      <name>Recovery Exhaustion</name>
      <formal-spec format="latex">∀recovery_attempt: attempts ≤ max_attempts ∨ escalate(error)</formal-spec>
    </property>
    <property id="P.F6.3">
      <name>State Safety</name>
      <formal-spec format="latex">∀e ∈ Error: recover(e) preserves system invariants
No partial state corruption</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Retry with Backoff</name>
      <signature>retry(operation: Operation, max_attempts: ℕ) → Result | Error</signature>
      <formal-definition format="latex">```
   retry(operation: Operation, max_attempts: ℕ) → Result | Error
   = attempts := 0
     while attempts &lt; max_attempts:
       try:
         return operation()
       catch error:
         if transient(error):
           wait(2^attempts · base_delay)
           attempts := attempts + 1
         else:
           throw error
     throw MaxAttemptsExceeded</formal-definition>
    </operation>
    <operation>
      <name>Circuit Breaker</name>
      <signature>circuit_breaker(operation: Operation, threshold: ℕ) → Result | Error</signature>
      <formal-definition format="latex">```
   circuit_breaker(operation: Operation, threshold: ℕ) → Result | Error
   = state := Closed
     failures := 0
     
     execute():
       case state of
         Closed → 
           try:
             result := operation()
             failures := 0
             return result
           catch error:
             failures := failures + 1
             if failures ≥ threshold:
               state := Open
               schedule_half_open(timeout)
             throw error
         Open → throw CircuitOpenError
         HalfOpen →
           try:
             result := operation()
             state := Closed
             return result
           catch error:
             state := Open
             throw error</formal-definition>
    </operation>
    <operation>
      <name>Graceful Degradation</name>
      <signature>degrade(levels: Sequence⟨Mode⟩, operation: Mode → Result) → Result</signature>
      <formal-definition format="latex">```
   degrade(levels: Sequence⟨Mode⟩, operation: Mode → Result) → Result
   = for mode in levels:
       try:
         return operation(mode)
       catch error:
         continue
     throw AllModesFailedError</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>Network request retry</name>
      <description>HTTP clients with backoff</description>
    </manifestation>
    <manifestation>
      <name>File load fallback</name>
      <description>multiple locations/mirrors</description>
    </manifestation>
    <manifestation>
      <name>Service degradation</name>
      <description>cache → static → error</description>
    </manifestation>
    <manifestation>
      <name>Database connection pooling</name>
      <description>retry on transient failures</description>
    </manifestation>
    <manifestation>
      <name>User retry prompts</name>
      <description>try again button</description>
    </manifestation>
  </manifestations>
</pattern>
