<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P40" version="1.1">
  <metadata>
    <name>Mode Toggle System</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$T = (M, m_0, \delta_{40}, \phi_{40}, \iota_{40})$</tuple-notation>
    <components>
      <component>
        <name>\delta_{40}</name>
        <type>M \times M → \{\text{allowed}, \text{forbidden}\}</type>
        <notation>\delta_{40}</notation>
        <description>**transition function**</description>
      </component>
      <component>
        <name>\phi_{40}</name>
        <type>M → UIConfig</type>
        <notation>\phi_{40}</notation>
        <description>maps mode to **UI configuration**</description>
      </component>
      <component>
        <name>\iota_{40}</name>
        <type>M → Indicator</type>
        <notation>\iota_{40}</notation>
        <description>provides **visual indicators**</description>
      </component>
    </components>
  </definition>
  <properties>
    <property id="P.P40.1">
      <name>Mutual Exclusivity</name>
      <formal-spec format="latex">∀t: ∃!m ∈ M: active(m, t)</formal-spec>
    </property>
    <property id="P.P40.2">
      <name>Transition Atomicity</name>
      <formal-spec format="latex">transition(m_i, m_j) succeeds ⇔ δ₄₀(m_i, m_j) = allowed</formal-spec>
    </property>
    <property id="P.P40.3">
      <name>UI Consistency</name>
      <formal-spec format="latex">active(m) ⇒ UI = φ₄₀(m)</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Toggle Mode</name>
      <signature>toggle(m_target: Mode) → Effect</signature>
      <formal-definition format="latex">```
   toggle(m_target: Mode) → Effect
   = if δ₄₀(m_current, m_target) = allowed:
       save_state(m_current)
       m_current := m_target
       apply_ui(φ₄₀(m_target))
       restore_state(m_target)</formal-definition>
    </operation>
    <operation>
      <name>Cycle Modes</name>
      <signature>cycle() → Effect</signature>
      <formal-definition format="latex">```
   cycle() → Effect
   = index := indexOf(M, m_current)
     toggle(M[(index + 1) mod |M|])</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>Auto-scroll toggle</name>
    </manifestation>
    <manifestation>
      <name>Edit vs Preview</name>
    </manifestation>
    <manifestation>
      <name>Tool modes</name>
    </manifestation>
    <manifestation>
      <name>View modes</name>
    </manifestation>
  </manifestations>
</pattern>
