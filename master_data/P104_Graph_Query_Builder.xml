<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P104" version="1.1">
  <metadata>
    <name>Graph Query Builder</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$B_{query} = (G, Q_{visual}, Cypher, Execute) : \text{UserInput} \to \text{Query}_{graph}$</tuple-notation>
    <components>
      <component>
        <name>G</name>
        <type>Graph⟨V, E⟩</type>
        <notation>G</notation>
        <description>underlying knowledge graph</description>
      </component>
      <component>
        <name>Q_{visual}</name>
        <type>VisualQuery</type>
        <notation>Q_{visual}</notation>
        <description>visual pattern representation</description>
      </component>
      <component>
        <name>Cypher</name>
        <type>String</type>
        <notation>Cypher</notation>
        <description>generated query language text</description>
      </component>
      <component>
        <name>Execute</name>
        <type>Cypher → ResultSet</type>
        <notation>Execute</notation>
        <description>query execution function</description>
      </component>
    </components>
  </definition>
  <type-definitions>
      <type-def>
        <name>Graph</name>
        <definition>$\text{Graph} = (V, E, \lambda_V, \lambda_E)$ where $V$ are vertices, $E \subseteq V \times V$ edges, $\lambda$ label functions</definition>
      </type-def>
      <type-def>
        <name>VisualQuery</name>
        <definition>$\text{VisualQuery} = (\text{nodes}, \text{edges}, \text{constraints})$ (pattern graph)</definition>
      </type-def>
      <type-def>
        <name>ResultSet</name>
        <definition>$\text{ResultSet} = \text{Set}\langle \text{Binding} \rangle$ where $\text{Binding} = \text{Var} \to \text{Node}$</definition>
      </type-def>
    </type-definitions>
  <properties>
    <property id="P.P104.1">
      <name>Visual-Textual Isomorphism</name>
      <formal-spec format="latex">$\forall q : \text{semantics}(Q_{visual}) \equiv \text{semantics}(Cypher)$ (equivalent meaning)</formal-spec>
    </property>
    <property id="P.P104.2">
      <name>Incremental Query Building</name>
      <formal-spec format="latex">$Q_{visual}^{(t+1)} = Q_{visual}^{(t)} \oplus \text{addPattern}(\pi)$ (compositional)</formal-spec>
    </property>
    <property id="P.P104.3">
      <name>Type Safety</name>
      <formal-spec format="latex">$\forall e \in Q_{visual}.edges : \text{type}(e.source) \text{ compatible with } \text{type}(e.target)$</formal-spec>
    </property>
    <property id="P.P104.4">
      <name>Query Optimization</name>
      <formal-spec format="latex">$Execute(Cypher) = Execute(\text{optimize}(Cypher))$ (semantic preserving optimization)</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Add Node Pattern</name>
      <signature>addNode: VisualQuery × NodeConstraint → VisualQuery</signature>
      <formal-definition format="latex">$\text{addNode}(q, n) = q'$ where
  $q'.nodes = q.nodes \cup \{n\}$
  $q'.constraints = q.constraints \cup \text{constraintsOf}(n)$</formal-definition>
    </operation>
    <operation>
      <name>Compile to Cypher</name>
      <signature>compile: VisualQuery → Cypher</signature>
      <formal-definition format="latex">$\text{compile}(q) = \text{cypher}$ where
  $\text{cypher} = \text{MATCH } \text{pattern}(q.nodes, q.edges)$
  $\text{     WHERE } \text{constraints}(q.constraints)$
  $\text{     RETURN } \text{variables}(q.nodes)$</formal-definition>
    </operation>
    <operation>
      <name>Execute Query</name>
      <signature>execute: Cypher × Graph → ResultSet</signature>
      <formal-definition format="latex">$\text{execute}(cypher, G) = \{b \mid b : \text{Var} \to V \land \text{satisfies}(b, cypher, G)\}$</formal-definition>
    </operation>
  </operations>
  <dependencies>
    <requires>
      <pattern-ref>P19</pattern-ref>
    </requires>
    <uses>
      <pattern-ref>P99</pattern-ref>
      <pattern-ref>P101</pattern-ref>
      <pattern-ref>P117</pattern-ref>
    </uses>
  </dependencies>
  <manifestations>
    <manifestation>
      <name>Neo4j Bloom query builder</name>
      <description>visual graph pattern matching</description>
    </manifestation>
    <manifestation>
      <name>GraphQL visual editor</name>
      <description>drag-and-drop query construction</description>
    </manifestation>
    <manifestation>
      <name>SPARQL query builder</name>
      <description>visual RDF triple pattern editor</description>
    </manifestation>
    <manifestation>
      <name>Knowledge graph exploration interface</name>
      <description>interactive pattern-based search</description>
    </manifestation>
  </manifestations>
</pattern>