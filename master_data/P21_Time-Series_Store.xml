<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P21" version="1.1">
  <metadata>
    <name>Time-Series Store</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$T = (series, timestamps, values, aggregations)$</tuple-notation>
    <components>
      <component>
        <name>series</name>
        <type>Map⟨String, TimeSeries⟩</type>
        <notation>series</notation>
        <description>named series</description>
      </component>
      <component>
        <name>timestamps</name>
        <type>Sequence⟨Time⟩</type>
        <notation>timestamps</notation>
        <description>ordered timestamps</description>
      </component>
      <component>
        <name>values</name>
        <type>Map⟨Time, Value⟩</type>
        <notation>values</notation>
        <description>data points</description>
      </component>
      <component>
        <name>aggregations</name>
        <type>(Time, Time, Func) → Value</type>
        <notation>aggregations</notation>
        <description>compute aggregates</description>
      </component>
    </components>
  </definition>
  <type-definitions>
    <type-def>
      <name>TimeSeries</name>
      <definition format="latex">Sequence⟨(timestamp: Time, value: Value)⟩</definition>
    </type-def>
    <type-def>
      <name>Aggregation</name>
      <definition format="latex">Sum | Avg | Min | Max | Count | ...</definition>
    </type-def>
  </type-definitions>
  <properties>
    <property id="P.P21.1">
      <name>Temporal Ordering</name>
      <formal-spec format="latex">timestamps are sorted: tᵢ &lt; tᵢ₊₁</formal-spec>
    </property>
    <property id="P.P21.2">
      <name>Efficient Range Queries</name>
      <formal-spec format="latex">range(t1, t2) uses binary search: O(log n + k) where k = result size</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Range Query</name>
      <signature>range(t1: Time, t2: Time) → TimeSeries</signature>
      <formal-definition format="latex">```
   range(t1: Time, t2: Time) → TimeSeries
   = {(t, v) ∈ series : t1 ≤ t ≤ t2}</formal-definition>
    </operation>
    <operation>
      <name>Aggregate</name>
      <signature>aggregate(t1: Time, t2: Time, window: Duration, func: Aggregation) → TimeSeries</signature>
      <formal-definition format="latex">```
   aggregate(t1: Time, t2: Time, window: Duration, func: Aggregation) → TimeSeries
   = group points in windows, apply func to each window</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>Edit history</name>
    </manifestation>
    <manifestation>
      <name>Telemetry</name>
    </manifestation>
    <manifestation>
      <name>Sensor data</name>
    </manifestation>
    <manifestation>
      <name>User activity log</name>
    </manifestation>
    <manifestation>
      <name>Stock prices</name>
    </manifestation>
  </manifestations>
</pattern>
