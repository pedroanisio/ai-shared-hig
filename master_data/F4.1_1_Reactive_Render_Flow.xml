<?xml version='1.0' encoding='utf-8'?>
<ns0:pattern xmlns:ns0="http://universal-corpus.org/schema/v1" id="F4.1" version="1.1">
  <ns0:metadata>
    <ns0:name />
    <ns0:category>pattern</ns0:category>
    <ns0:status>stable</ns0:status>
    <ns0:complexity>medium</ns0:complexity>
  </ns0:metadata>
  <ns0:definition>
    <ns0:tuple-notation format="latex">$R = (state, render, diff, patch)$</ns0:tuple-notation>
    <ns0:components>
      <ns0:component>
        <ns0:name>state</ns0:name>
        <ns0:type>State</ns0:type>
        <ns0:notation>state</ns0:notation>
        <ns0:description>current application state</ns0:description>
      </ns0:component>
      <ns0:component>
        <ns0:name>render</ns0:name>
        <ns0:type>State → VirtualDOM</ns0:type>
        <ns0:notation>render</ns0:notation>
        <ns0:description>creates virtual representation</ns0:description>
      </ns0:component>
      <ns0:component>
        <ns0:name>diff</ns0:name>
        <ns0:type>VirtualDOM × VirtualDOM → Patch</ns0:type>
        <ns0:notation>diff</ns0:notation>
        <ns0:description>computes changes</ns0:description>
      </ns0:component>
      <ns0:component>
        <ns0:name>patch</ns0:name>
        <ns0:type>Patch → Effect</ns0:type>
        <ns0:notation>patch</ns0:notation>
        <ns0:description>applies changes to actual DOM</ns0:description>
      </ns0:component>
    </ns0:components>
  </ns0:definition>
  <ns0:type-definitions>
    <ns0:type-def>
      <ns0:name>State</ns0:name>
      <ns0:definition format="latex">Application data that drives rendering</ns0:definition>
    </ns0:type-def>
    <ns0:type-def>
      <ns0:name>VirtualDOM</ns0:name>
      <ns0:definition format="latex">Tree representation of UI</ns0:definition>
    </ns0:type-def>
    <ns0:type-def>
      <ns0:name>Patch</ns0:name>
      <ns0:definition format="latex">Set⟨Operation⟩ where Operation := Insert | Update | Delete | Move</ns0:definition>
    </ns0:type-def>
    <ns0:type-def>
      <ns0:name>RealDOM</ns0:name>
      <ns0:definition format="latex">Actual browser DOM</ns0:definition>
    </ns0:type-def>
  </ns0:type-definitions>
  <ns0:properties>
    <ns0:property id="P.F4.1.1">
      <ns0:name>Reactivity</ns0:name>
      <ns0:formal-spec format="latex">state changes → render(state) → diff → patch → updated DOM
Automatic propagation</ns0:formal-spec>
    </ns0:property>
    <ns0:property id="P.F4.1.2">
      <ns0:name>Minimal Updates</ns0:name>
      <ns0:formal-spec format="latex">∀s₁, s₂ ∈ State: patch(diff(render(s₁), render(s₂))) applies minimal changes</ns0:formal-spec>
    </ns0:property>
    <ns0:property id="P.F4.1.3">
      <ns0:name>Consistency</ns0:name>
      <ns0:formal-spec format="latex">∀s ∈ State: visual_output(s) = render(s)
What you see reflects state</ns0:formal-spec>
    </ns0:property>
  </ns0:properties>
  <ns0:operations>
    <ns0:operation>
      <ns0:name>Update</ns0:name>
      <ns0:signature>update(new_state: State) → Effect</ns0:signature>
      <ns0:formal-definition format="latex">```
   update(new_state: State) → Effect
   = old_vdom := render(current_state)
     new_vdom := render(new_state)
     patch := diff(old_vdom, new_vdom)
     apply_patch(patch, real_dom)
     current_state := new_state</ns0:formal-definition>
    </ns0:operation>
    <ns0:operation>
      <ns0:name>Diff</ns0:name>
      <ns0:signature>diff(old: VirtualDOM, new: VirtualDOM) → Patch</ns0:signature>
      <ns0:formal-definition format="latex">```
   diff(old: VirtualDOM, new: VirtualDOM) → Patch
   = if old = new: return []
     if different_type(old, new): return [Replace(old, new)]
     if different_props(old, new): 
       ops := [UpdateProps(old, new)]
     else:
       ops := []
     ops := ops + diff_children(old.children, new.children)
     return ops</ns0:formal-definition>
    </ns0:operation>
    <ns0:operation>
      <ns0:name>Apply Patch</ns0:name>
      <ns0:signature>apply_patch(patch: Patch, dom: RealDOM) → Effect</ns0:signature>
      <ns0:formal-definition format="latex">```
   apply_patch(patch: Patch, dom: RealDOM) → Effect
   = for op in patch:
       case op of
         Insert(node, parent, index) → parent.insert_child(node, index)
         Update(node, props) → node.update_properties(props)
         Delete(node) → node.remove()
         Move(node, new_parent, new_index) → move(node, new_parent, new_index)</ns0:formal-definition>
    </ns0:operation>
  </ns0:operations>
  <ns0:manifestations>
    <ns0:manifestation>
      <ns0:name>React/Vue/Svelte rendering</ns0:name>
    </ns0:manifestation>
    <ns0:manifestation>
      <ns0:name>Virtual DOM frameworks</ns0:name>
    </ns0:manifestation>
    <ns0:manifestation>
      <ns0:name>Incremental rendering</ns0:name>
    </ns0:manifestation>
    <ns0:manifestation>
      <ns0:name>Reactive UI libraries</ns0:name>
    </ns0:manifestation>
    <ns0:manifestation>
      <ns0:name>Real-time dashboards</ns0:name>
    </ns0:manifestation>
  </ns0:manifestations>
</ns0:pattern>