<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="" version="1.1">
  <metadata>
    <name/>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$R = (state, render, diff, patch)$</tuple-notation>
    <components>
      <component>
        <name>state</name>
        <type>State</type>
        <notation>state</notation>
        <description>current application state</description>
      </component>
      <component>
        <name>render</name>
        <type>State → VirtualDOM</type>
        <notation>render</notation>
        <description>creates virtual representation</description>
      </component>
      <component>
        <name>diff</name>
        <type>VirtualDOM × VirtualDOM → Patch</type>
        <notation>diff</notation>
        <description>computes changes</description>
      </component>
      <component>
        <name>patch</name>
        <type>Patch → Effect</type>
        <notation>patch</notation>
        <description>applies changes to actual DOM</description>
      </component>
    </components>
  </definition>
  <type-definitions>
    <type-def>
      <name>State</name>
      <definition format="latex">Application data that drives rendering</definition>
    </type-def>
    <type-def>
      <name>VirtualDOM</name>
      <definition format="latex">Tree representation of UI</definition>
    </type-def>
    <type-def>
      <name>Patch</name>
      <definition format="latex">Set⟨Operation⟩ where Operation := Insert | Update | Delete | Move</definition>
    </type-def>
    <type-def>
      <name>RealDOM</name>
      <definition format="latex">Actual browser DOM</definition>
    </type-def>
  </type-definitions>
  <properties>
    <property id="P.F4.1.1">
      <name>Reactivity</name>
      <formal-spec format="latex">state changes → render(state) → diff → patch → updated DOM
Automatic propagation</formal-spec>
    </property>
    <property id="P.F4.1.2">
      <name>Minimal Updates</name>
      <formal-spec format="latex">∀s₁, s₂ ∈ State: patch(diff(render(s₁), render(s₂))) applies minimal changes</formal-spec>
    </property>
    <property id="P.F4.1.3">
      <name>Consistency</name>
      <formal-spec format="latex">∀s ∈ State: visual_output(s) = render(s)
What you see reflects state</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Update</name>
      <signature>update(new_state: State) → Effect</signature>
      <formal-definition format="latex">```
   update(new_state: State) → Effect
   = old_vdom := render(current_state)
     new_vdom := render(new_state)
     patch := diff(old_vdom, new_vdom)
     apply_patch(patch, real_dom)
     current_state := new_state</formal-definition>
    </operation>
    <operation>
      <name>Diff</name>
      <signature>diff(old: VirtualDOM, new: VirtualDOM) → Patch</signature>
      <formal-definition format="latex">```
   diff(old: VirtualDOM, new: VirtualDOM) → Patch
   = if old = new: return []
     if different_type(old, new): return [Replace(old, new)]
     if different_props(old, new): 
       ops := [UpdateProps(old, new)]
     else:
       ops := []
     ops := ops + diff_children(old.children, new.children)
     return ops</formal-definition>
    </operation>
    <operation>
      <name>Apply Patch</name>
      <signature>apply_patch(patch: Patch, dom: RealDOM) → Effect</signature>
      <formal-definition format="latex">```
   apply_patch(patch: Patch, dom: RealDOM) → Effect
   = for op in patch:
       case op of
         Insert(node, parent, index) → parent.insert_child(node, index)
         Update(node, props) → node.update_properties(props)
         Delete(node) → node.remove()
         Move(node, new_parent, new_index) → move(node, new_parent, new_index)</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>React/Vue/Svelte rendering</name>
    </manifestation>
    <manifestation>
      <name>Virtual DOM frameworks</name>
    </manifestation>
    <manifestation>
      <name>Incremental rendering</name>
    </manifestation>
    <manifestation>
      <name>Reactive UI libraries</name>
    </manifestation>
    <manifestation>
      <name>Real-time dashboards</name>
    </manifestation>
  </manifestations>
</pattern>
