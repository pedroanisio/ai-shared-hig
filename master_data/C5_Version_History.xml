<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="C5" version="1.1">
  <metadata>
    <name>Version History</name>
    <category>concept</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$H = (states, deltas, branches)$</tuple-notation>
    <components>
      <component>
        <name>states</name>
        <type>Sequence⟨State⟩</type>
        <notation>states</notation>
        <description>sequence of states</description>
      </component>
      <component>
        <name>deltas</name>
        <type>Sequence⟨Delta⟩</type>
        <notation>deltas</notation>
        <description>sequence of changes</description>
      </component>
      <component>
        <name>branches</name>
        <type>Tree⟨State⟩</type>
        <notation>branches</notation>
        <description>represents branch structure</description>
      </component>
    </components>
  </definition>
  <properties>
    <property id="P.C5.1">
      <name>Immutability</name>
      <formal-spec format="latex">∀s ∈ states: s is immutable once committed</formal-spec>
    </property>
    <property id="P.C5.2">
      <name>Reconstructability</name>
      <formal-spec format="latex">∀i: states[i] = apply_all(states[0], deltas[1..i])</formal-spec>
    </property>
    <property id="P.C5.3">
      <name>Branching</name>
      <formal-spec format="latex">branch(s, name) creates new branch from state s</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Checkout</name>
      <signature>checkout(H: History, t: Time) → State</signature>
      <formal-definition format="latex">```
   checkout(H: History, t: Time) → State
   = states[max{i : states[i].timestamp ≤ t}]</formal-definition>
    </operation>
    <operation>
      <name>Diff</name>
      <signature>diff(H: History, t₁: Time, t₂: Time) → Delta</signature>
      <formal-definition format="latex">```
   diff(H: History, t₁: Time, t₂: Time) → Delta
   = compute difference between states at t₁ and t₂</formal-definition>
    </operation>
    <operation>
      <name>Revert</name>
      <signature>revert(H: History, t: Time) → History</signature>
      <formal-definition format="latex">```
   revert(H: History, t: Time) → History
   = H' where H'.states = H.states + [checkout(H, t)]</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>Edit history</name>
      <description>Google Docs</description>
    </manifestation>
    <manifestation>
      <name>Git commits</name>
    </manifestation>
    <manifestation>
      <name>Feature sequence</name>
      <description>CAD timeline</description>
    </manifestation>
    <manifestation>
      <name>Proof versions</name>
      <description>Lean</description>
    </manifestation>
    <manifestation>
      <name>Database transaction log</name>
    </manifestation>
  </manifestations>
</pattern>
