<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P3" version="1.1">
  <metadata>
    <name>Hierarchical Navigator</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$N = (tree, selection, expansion, breadcrumb)$</tuple-notation>
    <components>
      <component>
        <name>tree</name>
        <type>Tree⟨Node⟩</type>
        <notation>tree</notation>
        <description>hierarchy</description>
      </component>
      <component>
        <name>selection</name>
        <type>Node | null</type>
        <notation>selection</notation>
        <description>current selection</description>
      </component>
      <component>
        <name>expansion</name>
        <type>Set⟨Node⟩</type>
        <notation>expansion</notation>
        <description>expanded nodes</description>
      </component>
      <component>
        <name>breadcrumb</name>
        <type>Sequence⟨Node⟩</type>
        <notation>breadcrumb</notation>
        <description>path to selection</description>
      </component>
    </components>
  </definition>
  <properties>
    <property id="P.P3.1">
      <name>Parent-Child Visibility</name>
      <formal-spec format="latex">visible(n) ⇒ visible(parent(n))
Expanding parent makes children visible.</formal-spec>
    </property>
    <property id="P.P3.2">
      <name>Breadcrumb Consistency</name>
      <formal-spec format="latex">breadcrumb = path_from_root(tree, selection)</formal-spec>
    </property>
    <property id="P.P3.3">
      <name>Lazy Loading</name>
      <formal-spec format="latex">expand(n) → load_children(n) only when n first expanded</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Expand Node</name>
      <signature>expand(n: Node) → Effect</signature>
      <formal-definition format="latex">```
   expand(n: Node) → Effect
   = if n ∉ expansion:
       expansion := expansion ∪ {n}
       load_children(n) if children(n) = unloaded
       render(tree)</formal-definition>
    </operation>
    <operation>
      <name>Select Node</name>
      <signature>select(n: Node) → Effect</signature>
      <formal-definition format="latex">```
   select(n: Node) → Effect
   = selection := n
     breadcrumb := compute_path(root, n)
     notify_observers(n)</formal-definition>
    </operation>
    <operation>
      <name>Navigate</name>
      <signature>navigate(direction: Direction) → Effect</signature>
      <formal-definition format="latex">```
   navigate(direction: Direction) → Effect
   = case direction of
       Down → select(next_visible(selection))
       Up → select(prev_visible(selection))
       Right → expand(selection) ; select(first_child(selection))
       Left → collapse(selection) | select(parent(selection))</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>File explorer</name>
      <description>OS file browser</description>
    </manifestation>
    <manifestation>
      <name>Feature tree</name>
      <description>CAD</description>
    </manifestation>
    <manifestation>
      <name>Theorem library</name>
      <description>Lean</description>
    </manifestation>
    <manifestation>
      <name>Layer panel</name>
      <description>Photoshop</description>
    </manifestation>
    <manifestation>
      <name>Outline view</name>
      <description>Word</description>
    </manifestation>
  </manifestations>
</pattern>
