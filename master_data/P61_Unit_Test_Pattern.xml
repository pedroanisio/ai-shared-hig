<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P61" version="1.1">
  <metadata>
    <name>Unit Test Pattern</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$U = (sut, arrange, act, assert, cleanup)$</tuple-notation>
    <components>
      <component>
        <name>sut</name>
        <type>System</type>
        <notation>sut</notation>
        <description>**system under test** (unit being tested)</description>
      </component>
      <component>
        <name>arrange</name>
        <type>() â†’ Context</type>
        <notation>arrange</notation>
        <description>sets up test preconditions</description>
      </component>
      <component>
        <name>act</name>
        <type>Context â†’ Result</type>
        <notation>act</notation>
        <description>exercises the unit</description>
      </component>
      <component>
        <name>assert</name>
        <type>Result â†’ \mathbb{B}</type>
        <notation>assert</notation>
        <description>verifies expectations</description>
      </component>
      <component>
        <name>cleanup</name>
        <type>Context â†’ Effect</type>
        <notation>cleanup</notation>
        <description>tears down test state</description>
      </component>
    </components>
  </definition>
  <type-definitions>
    <type-def>
      <name>System</name>
      <definition format="latex">Function | Class | Module</definition>
    </type-def>
    <type-def>
      <name>Context</name>
      <definition format="latex">(mocks: SetâŸ¨MockâŸ©, fixtures: SetâŸ¨FixtureâŸ©, state: State)</definition>
    </type-def>
    <type-def>
      <name>Mock</name>
      <definition format="latex">(target: Dependency, behavior: Specification)</definition>
    </type-def>
    <type-def>
      <name>Fixture</name>
      <definition format="latex">(data: Data, setup: () â†’ Effect, teardown: () â†’ Effect)</definition>
    </type-def>
  </type-definitions>
  <properties>
    <property id="P.P61.1">
      <name>Isolation</name>
      <formal-spec format="latex">Unit tests run independently
No shared state between tests</formal-spec>
    </property>
    <property id="P.P61.2">
      <name>Fast Execution</name>
      <formal-spec format="latex">Unit tests complete in milliseconds
No I/O, network, or database</formal-spec>
    </property>
    <property id="P.P61.3">
      <name>Repeatability</name>
      <formal-spec format="latex">Same input â†’ same output (deterministic)</formal-spec>
    </property>
    <property id="P.P61.4">
      <name>Single Assertion Focus</name>
      <formal-spec format="latex">Each test verifies one behavior
Clear failure messages</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Execute Test</name>
      <signature>execute_test(test: Test) â†’ TestResult</signature>
      <formal-definition format="latex">```
   execute_test(test: Test) â†’ TestResult
   = context := test.arrange()
     result := test.act(context)
     passed := test.assert(result)
     test.cleanup(context)
     return TestResult(passed, result, context)</formal-definition>
    </operation>
    <operation>
      <name>Run Test Suite</name>
      <signature>run_suite(tests: SetâŸ¨TestâŸ©) â†’ SuiteResult</signature>
      <formal-definition format="latex">```
   run_suite(tests: SetâŸ¨TestâŸ©) â†’ SuiteResult
   = results := []
     for test in tests:
       result := execute_test(test)
       results := results âˆª {result}
     return SuiteResult(results, summary(results))</formal-definition>
    </operation>
    <operation>
      <name>Mock Dependency</name>
      <signature>mock(dependency: Dependency, behavior: Specification) â†’ Mock</signature>
      <formal-definition format="latex">```
   mock(dependency: Dependency, behavior: Specification) â†’ Mock
   = mock := Mock(dependency)
     configure(mock, behavior)
     return mock
```
test_addition() â†’ ğ”¹
  // Arrange: Set up test data
  = calculator := Calculator()
    a := 2
    b := 3
    expected := 5
    
    // Act: Exercise the unit
    result := calculator.add(a, b)
    
    // Assert: Verify expectations
    assert(result = expected, "2 + 3 should equal 5")
    
    // Cleanup (if needed)
    cleanup()
```
Mock dependency behavior:
  mock_database := Mock(Database)
  mock_database.when(get_user(1)).then_return(User(1, "Alice"))
  
  service := UserService(mock_database)
  user := service.get_user(1)
  
  assert(user.name = "Alice")
  verify(mock_database.get_user).called_once_with(1)</formal-definition>
    </operation>
    <operation>
      <name>Given-When-Then (BDD style)</name>
      <signature/>
      <formal-definition format="latex">```
   test_user_login()
     Given: user exists with username "alice" and password "secret"
     When: user logs in with correct credentials
     Then: login succeeds and session is created</formal-definition>
    </operation>
    <operation>
      <name>Table-Driven Tests</name>
      <signature/>
      <formal-definition format="latex">```
   test_cases := [
     (input: 2, expected: 4),
     (input: 3, expected: 9),
     (input: 4, expected: 16)
   ]
   
   for (input, expected) in test_cases:
     result := square(input)
     assert(result = expected)</formal-definition>
    </operation>
    <operation>
      <name>Parameterized Tests</name>
      <signature/>
      <formal-definition format="latex">```
   @parameterized([
     (2, 3, 5),
     (10, 5, 15),
     (-1, 1, 0)
   ])
   test_addition(a, b, expected)
     result := add(a, b)
     assert(result = expected)
```
assert_equal(actual, expected)
assert_not_equal(actual, not_expected)
assert_true(condition)
assert_false(condition)
assert_null(value)
assert_not_null(value)
assert_contains(collection, item)
assert_raises(exception_type, callable)
assert_almost_equal(actual, expected, tolerance)</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>Unit tests</name>
      <description>pytest, Jest, JUnit</description>
    </manifestation>
    <manifestation>
      <name>TDD</name>
      <description>Test-Driven Development</description>
    </manifestation>
    <manifestation>
      <name>Component tests</name>
    </manifestation>
    <manifestation>
      <name>Function tests</name>
    </manifestation>
  </manifestations>
</pattern>
