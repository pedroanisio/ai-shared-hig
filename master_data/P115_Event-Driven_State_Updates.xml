<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P115" version="1.1">
  <metadata>
    <name>Event-Driven State Updates</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$U_{event} = (State, Event_{stream}, Reducer, UI_{sync}) : (\text{State}, \text{Events}) \to \text{State}'$</tuple-notation>
    <components>
      <component>
        <name>State</name>
        <type>ApplicationState</type>
        <notation>State</notation>
        <description>current application state</description>
      </component>
      <component>
        <name>Event_{stream}</name>
        <type>Stream⟨Event⟩</type>
        <notation>Event_{stream}</notation>
        <description>incoming event stream triggering updates</description>
      </component>
      <component>
        <name>Reducer</name>
        <type>State × Event → State</type>
        <notation>Reducer</notation>
        <description>pure function computing state transitions</description>
      </component>
      <component>
        <name>UI_{sync}</name>
        <type>State → Effect</type>
        <notation>UI_{sync}</notation>
        <description>synchronizes UI with state changes</description>
      </component>
    </components>
  </definition>
  <type-definitions>
      <type-def>
        <name>ApplicationState</name>
        <definition>$\text{State} = \text{Map}(\text{Key}, \text{Value})$ (immutable state tree)</definition>
      </type-def>
      <type-def>
        <name>Reducer</name>
        <definition>$\text{Reducer}: (S, E) \to S$ (pure, deterministic function)</definition>
      </type-def>
      <type-def>
        <name>Effect</name>
        <definition>$\text{Effect} = \text{IO}()$ (side-effectful operation)</definition>
      </type-def>
    </type-definitions>
  <properties>
    <property id="P.P115.1">
      <name>State Immutability</name>
      <formal-spec format="latex">$\forall e \in Events : Reducer(s, e) = s' \land s \neq s'$ (no mutation, new state returned)</formal-spec>
    </property>
    <property id="P.P115.2">
      <name>Reducer Determinism</name>
      <formal-spec format="latex">$\forall s, e : Reducer(s, e) = Reducer(s, e)$ (same input → same output)</formal-spec>
    </property>
    <property id="P.P115.3">
      <name>Event Sourcing</name>
      <formal-spec format="latex">$State_t = \text{foldl}(Reducer, State_0, \{e \in Event_{stream} \mid e.timestamp \leq t\})$</formal-spec>
    </property>
    <property id="P.P115.4">
      <name>UI Consistency</name>
      <formal-spec format="latex">$\forall s : UI_{sync}(s) \implies \text{rendered\_state} = s$ (eventual consistency)</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Process Event</name>
      <signature>processEvent: State × Event → State</signature>
      <formal-definition format="latex">$\text{processEvent}(s, e) = s'$ where
  $s' = Reducer(s, e)$
  $UI_{sync}(s')$ (side-effect)</formal-definition>
    </operation>
    <operation>
      <name>Subscribe to Events</name>
      <signature>subscribe: Stream⟨Event⟩ → Subscription</signature>
      <formal-definition format="latex">$\text{subscribe}(stream) = sub$ where
  $\forall e \in stream : \text{processEvent}(State_{current}, e)$</formal-definition>
    </operation>
    <operation>
      <name>Compute State Delta</name>
      <signature>delta: State × State → Diff</signature>
      <formal-definition format="latex">$\text{delta}(s_1, s_2) = \{(k, v_2) \mid k \in \text{keys}(s_2) \land s_1[k] \neq s_2[k]\}$</formal-definition>
    </operation>
  </operations>
  <dependencies>
    <requires>
      <pattern-ref>P22</pattern-ref>
      <pattern-ref>P29</pattern-ref>
    </requires>
    <uses>
      <pattern-ref>P30</pattern-ref>
      <pattern-ref>P31</pattern-ref>
      <pattern-ref>P112</pattern-ref>
      <pattern-ref>P113</pattern-ref>
      <pattern-ref>P116</pattern-ref>
    </uses>
  </dependencies>
  <manifestations>
    <manifestation>
      <name>Redux state management</name>
      <description>action → reducer → state updates</description>
    </manifestation>
    <manifestation>
      <name>AG-UI STATE_DELTA events</name>
      <description>agent state changes streaming to UI</description>
    </manifestation>
    <manifestation>
      <name>Elm architecture</name>
      <description>event-driven functional state updates</description>
    </manifestation>
    <manifestation>
      <name>React state updates from events</name>
      <description>event handlers trigger state changes</description>
    </manifestation>
  </manifestations>
</pattern>
