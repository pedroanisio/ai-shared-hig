<?xml version='1.0' encoding='utf-8'?>
<ns0:pattern xmlns:ns0="http://universal-corpus.org/schema/v1" id="F2.4" version="1.1">
  <ns0:metadata>
    <ns0:name />
    <ns0:category>pattern</ns0:category>
    <ns0:status>stable</ns0:status>
    <ns0:complexity>medium</ns0:complexity>
  </ns0:metadata>
  <ns0:definition>
    <ns0:tuple-notation format="latex">$E = (base, enrichers, combine, output)$</ns0:tuple-notation>
    <ns0:components>
      <ns0:component>
        <ns0:name>base</ns0:name>
        <ns0:type>BaseData</ns0:type>
        <ns0:notation>base</ns0:notation>
        <ns0:description>input data to enrich</ns0:description>
      </ns0:component>
      <ns0:component>
        <ns0:name>enrichers</ns0:name>
        <ns0:type>Set⟨Enricher⟩</ns0:type>
        <ns0:notation>enrichers</ns0:notation>
        <ns0:description>enrichment sources</ns0:description>
      </ns0:component>
      <ns0:component>
        <ns0:name>combine</ns0:name>
        <ns0:type>BaseData × Set⟨Enrichment⟩ → EnrichedData</ns0:type>
        <ns0:notation>combine</ns0:notation>
        <ns0:description>merges enrichments</ns0:description>
      </ns0:component>
      <ns0:component>
        <ns0:name>output</ns0:name>
        <ns0:type>EnrichedData</ns0:type>
        <ns0:notation>output</ns0:notation>
        <ns0:description>enriched result</ns0:description>
      </ns0:component>
    </ns0:components>
  </ns0:definition>
  <ns0:type-definitions>
    <ns0:type-def>
      <ns0:name>BaseData</ns0:name>
      <ns0:definition format="latex">Core data requiring enrichment</ns0:definition>
    </ns0:type-def>
    <ns0:type-def>
      <ns0:name>Enricher</ns0:name>
      <ns0:definition format="latex">(source: String, enrich: BaseData → Enrichment)</ns0:definition>
    </ns0:type-def>
    <ns0:type-def>
      <ns0:name>Enrichment</ns0:name>
      <ns0:definition format="latex">Additional data from external source</ns0:definition>
    </ns0:type-def>
    <ns0:type-def>
      <ns0:name>EnrichedData</ns0:name>
      <ns0:definition format="latex">BaseData + aggregated Enrichments</ns0:definition>
    </ns0:type-def>
  </ns0:type-definitions>
  <ns0:properties>
    <ns0:property id="P.F2.4.1">
      <ns0:name>Non-Destructive</ns0:name>
      <ns0:formal-spec format="latex">∀b ∈ BaseData: base_fields(combine(b, enrichments)) = b
Original data preserved</ns0:formal-spec>
    </ns0:property>
    <ns0:property id="P.F2.4.2">
      <ns0:name>Parallel Enrichment</ns0:name>
      <ns0:formal-spec format="latex">∀e₁, e₂ ∈ enrichers: e₁ and e₂ can execute in parallel</ns0:formal-spec>
    </ns0:property>
    <ns0:property id="P.F2.4.3">
      <ns0:name>Partial Failure Tolerance</ns0:name>
      <ns0:formal-spec format="latex">failure(enricher_i) ⇏ failure(entire_flow)
Flow continues with available enrichments</ns0:formal-spec>
    </ns0:property>
  </ns0:properties>
  <ns0:operations>
    <ns0:operation>
      <ns0:name>Enrich</ns0:name>
      <ns0:signature>enrich(base: BaseData) → EnrichedData</ns0:signature>
      <ns0:formal-definition format="latex">```
   enrich(base: BaseData) → EnrichedData
   = enrichments := parallel_map(enrichers, λe: e.enrich(base))
     successful := {e : e ∈ enrichments ∧ ¬is_error(e)}
     return combine(base, successful)</ns0:formal-definition>
    </ns0:operation>
    <ns0:operation>
      <ns0:name>Fetch Enrichment</ns0:name>
      <ns0:signature>fetch(source: Enricher, base: BaseData) → Enrichment | Error</ns0:signature>
      <ns0:formal-definition format="latex">```
   fetch(source: Enricher, base: BaseData) → Enrichment | Error
   = try:
       return source.enrich(base)
     catch timeout:
       return partial_enrichment(source, base)
     catch error:
       return error</ns0:formal-definition>
    </ns0:operation>
    <ns0:operation>
      <ns0:name>Combine</ns0:name>
      <ns0:signature>combine(base: BaseData, enrichments: Set⟨Enrichment⟩) → EnrichedData</ns0:signature>
      <ns0:formal-definition format="latex">```
   combine(base: BaseData, enrichments: Set⟨Enrichment⟩) → EnrichedData
   = result := base
     for enrichment in enrichments:
       result := merge(result, enrichment)
     return result</ns0:formal-definition>
    </ns0:operation>
  </ns0:operations>
  <ns0:manifestations>
    <ns0:manifestation>
      <ns0:name>Data augmentation</ns0:name>
      <ns0:description>ML training</ns0:description>
    </ns0:manifestation>
    <ns0:manifestation>
      <ns0:name>Content enrichment</ns0:name>
      <ns0:description>metadata, tags</ns0:description>
    </ns0:manifestation>
    <ns0:manifestation>
      <ns0:name>Profile enrichment</ns0:name>
      <ns0:description>user data + social + behavior</ns0:description>
    </ns0:manifestation>
    <ns0:manifestation>
      <ns0:name>Product enrichment</ns0:name>
      <ns0:description>details + reviews + pricing</ns0:description>
    </ns0:manifestation>
    <ns0:manifestation>
      <ns0:name>Log enrichment</ns0:name>
      <ns0:description>traces + metrics + context</ns0:description>
    </ns0:manifestation>
  </ns0:manifestations>
</ns0:pattern>