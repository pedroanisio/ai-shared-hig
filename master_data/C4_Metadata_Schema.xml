<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="C4" version="1.1">
  <metadata>
    <name>Metadata Schema</name>
    <category>concept</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$M = (schema, data, validators)$</tuple-notation>
    <components>
      <component>
        <name>schema</name>
        <type>MapâŸ¨String, TypeâŸ©</type>
        <notation>schema</notation>
        <description>defines field types</description>
      </component>
      <component>
        <name>data</name>
        <type>MapâŸ¨String, ValueâŸ©</type>
        <notation>data</notation>
        <description>actual metadata</description>
      </component>
      <component>
        <name>validators</name>
        <type>MapâŸ¨String, PredicateâŸ©</type>
        <notation>validators</notation>
        <description>validation rules</description>
      </component>
    </components>
  </definition>
  <properties>
    <property id="P.C4.1">
      <name>Type Safety</name>
      <formal-spec format="latex">âˆ€k âˆˆ keys(data): type(data[k]) = schema[k]</formal-spec>
    </property>
    <property id="P.C4.2">
      <name>Validation</name>
      <formal-spec format="latex">valid(M) â‡” âˆ€k âˆˆ keys(data): validators[k](data[k])</formal-spec>
    </property>
    <property id="P.C4.3">
      <name>Extensibility</name>
      <formal-spec format="latex">extend(M, k, v) â†’ M' where keys(M'.data) = keys(M.data) âˆª {k}</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Add Field</name>
      <signature>add(M: Metadata, k: String, v: Value) â†’ Metadata</signature>
      <formal-definition format="latex">```
   add(M: Metadata, k: String, v: Value) â†’ Metadata
   = M' where M'.data[k] = v
            âˆ§ validate(M'.schema[k], v)</formal-definition>
    </operation>
    <operation>
      <name>Query</name>
      <signature>query(M: Metadata, pred: Predicate) â†’ ğ”¹</signature>
      <formal-definition format="latex">```
   query(M: Metadata, pred: Predicate) â†’ ğ”¹
   = pred(M.data)</formal-definition>
    </operation>
    <operation>
      <name>Index</name>
      <signature>index(docs: SetâŸ¨DocumentâŸ©, field: String) â†’ MapâŸ¨Value, SetâŸ¨DocumentâŸ©âŸ©</signature>
      <formal-definition format="latex">```
   index(docs: SetâŸ¨DocumentâŸ©, field: String) â†’ MapâŸ¨Value, SetâŸ¨DocumentâŸ©âŸ©
   = group documents by field value</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>Tags</name>
      <description>blog posts, notes</description>
    </manifestation>
    <manifestation>
      <name>Properties</name>
      <description>CAD features</description>
    </manifestation>
    <manifestation>
      <name>Attributes</name>
      <description>HTML elements</description>
    </manifestation>
    <manifestation>
      <name>Annotations</name>
      <description>PDF, code comments</description>
    </manifestation>
    <manifestation>
      <name>Labels</name>
      <description>issue tracking</description>
    </manifestation>
  </manifestations>
</pattern>
