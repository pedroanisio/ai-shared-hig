<?xml version="1.0" ?>
<pattern xmlns="http://universal-corpus.org/schema/v1" id="P9" version="1.1">
  <metadata>
    <name>Backlinks/References</name>
    <category>pattern</category>
    <status>stable</status>
    <complexity>medium</complexity>
  </metadata>
  <definition>
    <tuple-notation format="latex">$L = (forward_links, reverse_index, display)$</tuple-notation>
    <components>
      <component>
        <name>forward_links</name>
        <type>Map⟨Item, Set⟨Item⟩⟩</type>
        <notation>forward_links</notation>
        <description>explicit links</description>
      </component>
      <component>
        <name>reverse_index</name>
        <type>Map⟨Item, Set⟨Item⟩⟩</type>
        <notation>reverse_index</notation>
        <description>backlinks</description>
      </component>
      <component>
        <name>display</name>
        <type>Item → Component</type>
        <notation>display</notation>
        <description>renders link panel</description>
      </component>
    </components>
  </definition>
  <properties>
    <property id="P.P9.1">
      <name>Symmetry</name>
      <formal-spec format="latex">item₁ ∈ forward_links[item₂] ⇔ item₂ ∈ reverse_index[item₁]</formal-spec>
    </property>
    <property id="P.P9.2">
      <name>Bidirectional Navigation</name>
      <formal-spec format="latex">view(item) → display backlinks and forward links</formal-spec>
    </property>
    <property id="P.P9.3">
      <name>Auto-Update</name>
      <formal-spec format="latex">add_link(A, B) → reverse_index[B] := reverse_index[B] ∪ {A}</formal-spec>
    </property>
  </properties>
  <operations>
    <operation>
      <name>Get Backlinks</name>
      <signature>backlinks(item: Item) → Set⟨Item⟩</signature>
      <formal-definition format="latex">```
   backlinks(item: Item) → Set⟨Item⟩
   = reverse_index[item] | ∅</formal-definition>
    </operation>
    <operation>
      <name>Get Forward Links</name>
      <signature>forward_links(item: Item) → Set⟨Item⟩</signature>
      <formal-definition format="latex">```
   forward_links(item: Item) → Set⟨Item⟩
   = forward_links[item] | ∅</formal-definition>
    </operation>
    <operation>
      <name>Update Index</name>
      <signature>update_index(item: Item, links: Set⟨Item⟩) → Effect</signature>
      <formal-definition format="latex">```
   update_index(item: Item, links: Set⟨Item⟩) → Effect
   = old_links := forward_links[item]
     removed := old_links ∖ links
     added := links ∖ old_links
     
     for r in removed:
       reverse_index[r] := reverse_index[r] ∖ {item}
     
     for a in added:
       reverse_index[a] := reverse_index[a] ∪ {item}
     
     forward_links[item] := links</formal-definition>
    </operation>
  </operations>
  <manifestations>
    <manifestation>
      <name>Backlinks panel</name>
      <description>Roam Research, Obsidian</description>
    </manifestation>
    <manifestation>
      <name>References</name>
      <description>IDEs</description>
    </manifestation>
    <manifestation>
      <name>Usages</name>
      <description>code analysis</description>
    </manifestation>
    <manifestation>
      <name>Dependencies</name>
      <description>package managers</description>
    </manifestation>
    <manifestation>
      <name>Citations</name>
      <description>academic papers</description>
    </manifestation>
  </manifestations>
</pattern>
