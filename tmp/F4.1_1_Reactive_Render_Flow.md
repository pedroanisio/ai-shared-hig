### F4.1 Reactive Render Flow

**Definition F4.1:**
A reactive render flow is a tuple $R = (state, render, diff, patch)$ where:
- $state : State$ is the current application state
- $render : State → VirtualDOM$ creates virtual representation
- $diff : VirtualDOM × VirtualDOM → Patch$ computes changes
- $patch : Patch → Effect$ applies changes to actual DOM

**Type Definitions:**
```
State := Application data that drives rendering
VirtualDOM := Tree representation of UI
Patch := Set⟨Operation⟩ where Operation := Insert | Update | Delete | Move
RealDOM := Actual browser DOM
```

**Properties:**

**P.F4.1.1 (Reactivity):**
```
state changes → render(state) → diff → patch → updated DOM
Automatic propagation
```

**P.F4.1.2 (Minimal Updates):**
```
∀s₁, s₂ ∈ State: patch(diff(render(s₁), render(s₂))) applies minimal changes
```

**P.F4.1.3 (Consistency):**
```
∀s ∈ State: visual_output(s) = render(s)
What you see reflects state
```

**Operations:**

1. **Update:**
   ```
   update(new_state: State) → Effect
   = old_vdom := render(current_state)
     new_vdom := render(new_state)
     patch := diff(old_vdom, new_vdom)
     apply_patch(patch, real_dom)
     current_state := new_state
   ```

2. **Diff:**
   ```
   diff(old: VirtualDOM, new: VirtualDOM) → Patch
   = if old = new: return []
     if different_type(old, new): return [Replace(old, new)]
     if different_props(old, new): 
       ops := [UpdateProps(old, new)]
     else:
       ops := []
     ops := ops + diff_children(old.children, new.children)
     return ops
   ```

3. **Apply Patch:**
   ```
   apply_patch(patch: Patch, dom: RealDOM) → Effect
   = for op in patch:
       case op of
         Insert(node, parent, index) → parent.insert_child(node, index)
         Update(node, props) → node.update_properties(props)
         Delete(node) → node.remove()
         Move(node, new_parent, new_index) → move(node, new_parent, new_index)
   ```

**Manifestations:**
- React/Vue/Svelte rendering
- Virtual DOM frameworks
- Incremental rendering
- Reactive UI libraries
- Real-time dashboards

---

